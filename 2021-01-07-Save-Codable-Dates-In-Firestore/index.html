<!DOCTYPE html><html lang="en" data-theme="light"><head><meta content="utf-8" name="charset"></meta><meta content="width=device-width, initial-scale=1, maximum-scale=5" name="viewport"></meta><meta content="only light" name="color-scheme"></meta><title>Khan's Blog · Save Codable Dates In Firestore</title><meta content="Avoid JSON decoding errors when using Dates with Firestore and Codable." name="description"></meta><meta content="all" name="robots"></meta><meta content="Khan Winter, Swift, macOS, JavaScript, iOS, web development, blog, SwiftUI" name="keywords"></meta><meta content="website" property="og:type"></meta><meta content="Khan's Blog" property="og:sitename"></meta><meta content="https://khanwinter.com/2021-01-07-Save-Codable-Dates-In-Firestore/" property="og:url"></meta><meta content="Khan's Blog · Save Codable Dates In Firestore" property="og:title"></meta><meta content="Avoid JSON decoding errors when using Dates with Firestore and Codable." property="og:description"></meta><meta content="https://khanwinter.com/2021-01-07-Save-Codable-Dates-In-Firestore/" property="twitter:url"></meta><meta content="Khan's Blog · Save Codable Dates In Firestore" property="twitter:title"></meta><meta content="Avoid JSON decoding errors when using Dates with Firestore and Codable." property="twitter:description"></meta><link href="https://khanwinter.com/2021-01-07-Save-Codable-Dates-In-Firestore/" rel="canonical"/><link href="https://bsky.app/profile/khanwinter.com" rel="me"/><link href="https://twitter.com/thecoolwinter" rel="me"/><link href="https://mastodon.social/@thecoolwinter" rel="me"/><link href="https://threads.net/thecoolwinter" rel="me"/><link href="https://www.linkedin.com/in/thecoolwinter/" rel="me"/><link href="/assets/index.css" rel="stylesheet"/><script src="/assets/index.js"></script><link href="/assets/prism.css" rel="stylesheet"/><link href="/assets/code-theme.css" rel="stylesheet"/><script defer src="/assets/prism.js"></script><link data-nav="true" href="/" rel="prefetch"/><link data-nav="true" href="/about" rel="prefetch"/><link data-nav="true" href="/2025-03-29-Cross-Compiling-Swift/" rel="prefetch"/><link data-nav="true" href="/2024-11-02-New-Blog/" rel="prefetch"/><link data-nav="true" href="/2024-11-01-Hide-Desktop-Shortcut/" rel="prefetch"/><link data-nav="true" href="/2021-08-07-Sort-List-Of-Objects/" rel="prefetch"/><link data-nav="true" href="/2021-05-08-Implementing-Sin/" rel="prefetch"/><link data-nav="true" href="/2021-03-17-How-Computers-Calculate-Sin/" rel="prefetch"/><link data-nav="true" href="/2021-02-02-The-Search-Engine-Matrix/" rel="prefetch"/><link data-nav="true" href="/2021-01-07-Save-Codable-Dates-In-Firestore/" rel="prefetch"/><link data-nav="true" href="/2020-05-5-Scripting-With-Swift/" rel="prefetch"/><link data-nav="true" href="/2020-02-24-Programatic-UI-In-UIKit-Without-Storyboards/" rel="prefetch"/><link data-nav="true" href="/2020-11-04-Getting-Started-With-Vapor-4/" rel="prefetch"/><link data-nav="true" href="/2019-12-17-Save-Array-Of-Any-Object-In-Realm/" rel="prefetch"/><link data-nav="true" href="/2020-05-11-Subclassing-Sprites-In-SpriteKit/" rel="prefetch"/><link data-nav="true" href="/2020-05-5-Using-Dependencies-In-Swift-Scripts/" rel="prefetch"/><link data-nav="true" href="/2020-02-21-Easy-Container-Controllers-in-Swift/" rel="prefetch"/><link data-nav="true" href="/2019-12-19-Firebase-Auth-State-Listeners-iOS/" rel="prefetch"/></head><body><nav><ul><li><a href="/index.html">Posts</a></li><li><button onclick="navRandom()">Random</button></li><li><a href="/about.html">About</a></li></ul></nav><div class="content"><article><div class="article-header"><p>Jan 7, 2021</p><h1>Save Codable Dates In Firestore</h1><h3>Avoid JSON decoding errors when using Dates with Firestore and Codable.</h3><div class="avatar" href="/about.html"><a href="/about.html"><img alt="Avatar Image" height="24" src="/assets/avatar.webp" width="24"></img><span>Khan Winter</span></a>·<a href="https://bsky.app/profile/khanwinter.com" target="_blank"><svg aria-label="Bluesky" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" version="1.1"><path d="m135.72 44.03c66.496 49.921 138.02 151.14 164.28 205.46 26.262-54.316 97.782-155.54 164.28-205.46 47.98-36.021 125.72-63.892 125.72 24.795 0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-0.0174-2.9357-1.1937 0.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07 0-88.687 77.742-60.816 125.72-24.795z"/></svg></a></div></div><h2 id="lets-say-we-have-a-codable-object-we-want-to-save-in-firestore"><a href="#lets-say-we-have-a-codable-object-we-want-to-save-in-firestore" class="header-link">Lets say we have a Codable object we want to save in Firestore</a></h2><p>This object has <code>name</code>, and <code>dateUpdated</code> properties. The <code>dateUpdated</code> property is a <code>Date</code> object. The implementation looks like this:</p><pre><code class="language-swift">class Name: Codable {
    var name: String
    var dateUpdated: Date
}
</code></pre><p>To make my life easier, I've added a custom init to this object to convert it from <code>[String: Any]</code> to a <code>Name</code> object.</p><pre><code class="language-swift">extension Name {
    init(dictionary: [String: Any]) throws {
        let data = try JSONSerialization.data(withJSONObject: dictionary, options: .prettyPrinted)
        self = try decoder.decode(Self.self, from: data)
    }
}
</code></pre><p>Pretty easy! Now when I get a response from Firestore I can just convert it to my object like this.</p><pre><code class="language-swift">if let document = snapshot.documents.first {
    let data = document.data()
    let name: Name? = try? Name(data)
}
</code></pre><p>And I have a function that converts the object into a dictionary to save it to firestore.</p><pre><code class="language-swift">func dictionary() throws -&gt; [String: Any] {
    let data = try JSONEncoder().encode(self)
    guard let dictionary = try JSONSerialization.jsonObject(with: data, options: .allowFragments) as? [String: Any] else {
        throw NSError()
    }
    return dictionary
}
</code></pre><h2 id="whats-the-problem"><a href="#whats-the-problem" class="header-link">What's the problem?</a></h2><p>If you try saving an object with a <code>Date</code> property to Firestore, Firestore automatically changes the <code>Date</code> to a <code>Timestamp</code>. This probably wouldn't be a problem, unless you're trying to decode that same object where you'll get the error:</p><pre><code class="language-swift">"Invalid type in JSON write (FIRTimestamp)"
</code></pre><p>This is being caused because Swift's Foundation doesn't know how to decode Firestore's <code>Timestamp</code> type from JSON.</p><h2 id="how-do-you-fix-it"><a href="#how-do-you-fix-it" class="header-link">How do you fix it?</a></h2><p>It's pretty simple actually, we just tell the <code>JSONDecoder</code> and <code>JSONEncoder</code> to use a special way of encoding/decoding dates. It's just a few line's change for each of the methods in the class.</p><pre><code class="language-swift">extension Name {
    init(dictionary: [String: Any]) throws {
        let data = try JSONSerialization.data(withJSONObject: dictionary, options: .prettyPrinted)
        let decoder = JSONDecoder() // Change
        decoder.dateDecodingStrategy = .secondsSince1970 // Change
        self = try decoder.decode(Self.self, from: data) // Change
    }

    func dictionary() throws -&gt; [String: Any] {
        let encoder = JSONEncoder() // Change
        encoder.dateEncodingStrategy = .secondsSince1970 // Change    
        let data = try encoder.encode(self)
        guard let dictionary = try JSONSerialization.jsonObject(with: data, options: .allowFragments) as? [String: Any] else {
          throw NSError()
        }
        return dictionary
    }
}
</code></pre><p>All this is doing is telling swift to save our <code>dateUpdated</code> date as a number instead of an actual date. This way, Firestore doesn't try to change any <code>Date</code> types to <code>Timestamps</code> and we don't get the aforementioned error.</p><p>The change made was instead of using a bare <code>JSONEncoder</code> or <code>JSONDecoder</code>, I changed it to use this:</p><pre><code class="language-swift">let encoder = JSONEncoder()
encoder.dateEncodingStrategy = .secondsSince1970
</code></pre><p>This is applicable to other environments too. If you're building a server using swift, you can use those custom <code>JSONEncoder</code>/<code>JSONDecoder</code> date strategies to encode date types so you know what they'll look like on the server side. The other options for date strategies can be found in the <a href="https://developer.apple.com/documentation/foundation/jsondecoder/2895216-datedecodingstrategy">documentation</a>.</p><hr></hr><div class="article-footer"><p>Jan 7, 2021</p><div class="avatar" href="/about.html"><a href="/about.html"><img alt="Avatar Image" height="24" src="/assets/avatar.webp" width="24"></img><span>Khan Winter</span></a>·<a href="https://bsky.app/profile/khanwinter.com" target="_blank"><svg aria-label="Bluesky" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" version="1.1"><path d="m135.72 44.03c66.496 49.921 138.02 151.14 164.28 205.46 26.262-54.316 97.782-155.54 164.28-205.46 47.98-36.021 125.72-63.892 125.72 24.795 0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-0.0174-2.9357-1.1937 0.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07 0-88.687 77.742-60.816 125.72-24.795z"/></svg></a></div></div></article></div><footer><p>Copyright &copy Khan Winter 2025</p><p><a href="https://github.com/thecoolwinter/blog">Built In Swift</a></p><p><a href="https://bsky.app/profile/khanwinter.com" rel="me" target="_blank">Bluesky</a> | <a href>RSS</a></p></footer></body></html>