<!DOCTYPE html><html lang="en" data-theme="light"><head><meta content="utf-8" name="charset"></meta><meta content="width=device-width, initial-scale=1, maximum-scale=5" name="viewport"></meta><meta content="only light" name="color-scheme"></meta><title>Khan's Blog · Implementing Sin(x)</title><meta content="We have a basic sin function, now we need to calculate more than π/2, and do it fast." name="description"></meta><meta content="all" name="robots"></meta><meta content="Khan Winter, Swift, macOS, JavaScript, iOS, web development, blog, SwiftUI" name="keywords"></meta><meta content="website" property="og:type"></meta><meta content="Khan's Blog" property="og:sitename"></meta><meta content="https://khanwinter.com/2021-05-08-Implementing-Sin/" property="og:url"></meta><meta content="Khan's Blog · Implementing Sin(x)" property="og:title"></meta><meta content="We have a basic sin function, now we need to calculate more than π/2, and do it fast." property="og:description"></meta><meta content="https://khanwinter.com/2021-05-08-Implementing-Sin/" property="twitter:url"></meta><meta content="Khan's Blog · Implementing Sin(x)" property="twitter:title"></meta><meta content="We have a basic sin function, now we need to calculate more than π/2, and do it fast." property="twitter:description"></meta><link href="https://khanwinter.com/2021-05-08-Implementing-Sin/" rel="canonical"/><link href="https://bsky.app/profile/khanwinter.com" rel="me"/><link href="https://twitter.com/thecoolwinter" rel="me"/><link href="https://mastodon.social/@thecoolwinter" rel="me"/><link href="https://threads.net/thecoolwinter" rel="me"/><link href="https://www.linkedin.com/in/thecoolwinter/" rel="me"/><link href="/assets/index.css" rel="stylesheet"/><script src="/assets/index.js"></script><link href="/assets/prism.css" rel="stylesheet"/><link href="/assets/code-theme.css" rel="stylesheet"/><script defer src="/assets/prism.js"></script><link data-nav="true" href="/" rel="prefetch"/><link data-nav="true" href="/about" rel="prefetch"/><link data-nav="true" href="/2025-03-29-Cross-Compiling-Swift/" rel="prefetch"/><link data-nav="true" href="/2024-11-02-New-Blog/" rel="prefetch"/><link data-nav="true" href="/2024-11-01-Hide-Desktop-Shortcut/" rel="prefetch"/><link data-nav="true" href="/2021-08-07-Sort-List-Of-Objects/" rel="prefetch"/><link data-nav="true" href="/2021-05-08-Implementing-Sin/" rel="prefetch"/><link data-nav="true" href="/2021-03-17-How-Computers-Calculate-Sin/" rel="prefetch"/><link data-nav="true" href="/2021-02-02-The-Search-Engine-Matrix/" rel="prefetch"/><link data-nav="true" href="/2021-01-07-Save-Codable-Dates-In-Firestore/" rel="prefetch"/><link data-nav="true" href="/2020-05-5-Scripting-With-Swift/" rel="prefetch"/><link data-nav="true" href="/2020-02-24-Programatic-UI-In-UIKit-Without-Storyboards/" rel="prefetch"/><link data-nav="true" href="/2020-11-04-Getting-Started-With-Vapor-4/" rel="prefetch"/><link data-nav="true" href="/2019-12-17-Save-Array-Of-Any-Object-In-Realm/" rel="prefetch"/><link data-nav="true" href="/2020-05-11-Subclassing-Sprites-In-SpriteKit/" rel="prefetch"/><link data-nav="true" href="/2020-05-5-Using-Dependencies-In-Swift-Scripts/" rel="prefetch"/><link data-nav="true" href="/2020-02-21-Easy-Container-Controllers-in-Swift/" rel="prefetch"/><link data-nav="true" href="/2019-12-19-Firebase-Auth-State-Listeners-iOS/" rel="prefetch"/></head><body><nav><ul><li><a href="/index.html">Posts</a></li><li><button onclick="navRandom()">Random</button></li><li><a href="/about.html">About</a></li></ul></nav><div class="content"><article><div class="article-header"><p>May 8, 2021</p><h1>Implementing Sin(x)</h1><h3>We have a basic sin function, now we need to calculate more than π/2, and do it fast.</h3><div class="avatar" href="/about.html"><a href="/about.html"><img alt="Avatar Image" height="24" src="/assets/avatar.webp" width="24"></img><span>Khan Winter</span></a>·<a href="https://bsky.app/profile/khanwinter.com" target="_blank"><svg aria-label="Bluesky" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" version="1.1"><path d="m135.72 44.03c66.496 49.921 138.02 151.14 164.28 205.46 26.262-54.316 97.782-155.54 164.28-205.46 47.98-36.021 125.72-63.892 125.72 24.795 0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-0.0174-2.9357-1.1937 0.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07 0-88.687 77.742-60.816 125.72-24.795z"/></svg></a></div></div><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" integrity="sha384-nB0miv6/jRmo5UMMR1wu3Gz6NLsoTkbqJghGIsx//Rlm+ZU03BU6SQNC66uf4l5+" rel="stylesheet"></link><script crossorigin="anonymous" defer integrity="sha384-7zkQWkzuo3B5mTepMUcHkMB5jZaolc2xDwL6VFqjFALcbeS9Ggm/Yr2r3Dy4lfFg" src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script><script crossorigin="anonymous" defer integrity="sha384-43gviWU0YVjaDtb/GhzOouOXtZMP/7XUzwPTstBeZFe/+rCMvRwr4yROQP43s0Xk" src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"></script><script>document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        delimiters: [
            {left: '$$', right: '$$', display: true},
            {left: '$', right: '$', display: false},
        ],
        throwOnError : true
    });
});</script><h2 id="previously-on"><a href="#previously-on" class="header-link">Previously on...</a></h2><p>In my last post, I used Taylor Series to come up with a function to estimate <span class="math-inline">$sin(x)$</span> for any number between <span class="math-inline">$0$</span> and <span class="math-inline">$\frac{\pi}{2}$</span>. While this is cool, it's rather useless. But, thankfully, I can use the numbers we can already to calculate any number of <span class="math-inline">$sin(x)$</span>.</p><blockquote><p>If you haven't read my previous post, it's a good read and will definitely make this post make much more sense. <a href="https://windchillblog.com/2021/03/17/How-Computers-Calculate-Sin.html">You can read that post here</a>.</p></blockquote><h2 id="sin-repeats"><a href="#sin-repeats" class="header-link">Sin Repeats</a></h2><span class="math-block">$$sin(x)$$</span><p>has an awesome property that I'm going to take complete advantage of for this implementation. <strong>Sin is the exact same from <span class="math-inline">$0$</span> to <span class="math-inline">$\frac{\pi}{2}$</span> everywhere else on the number line.</strong> All the rest of the numbers are flipped horizontally, or vertically, or both.</p><p>It's easier to see this with the graph of <span class="math-inline">$sin(x)$</span>.</p><img src="sin.png" alt="sin(x) with points 0, pi/2, 3pi/2, pi and 2pi highlighted"/><p>It's pretty easy if you can rotate your phone/laptop to see that the curve from <span class="math-inline">$0$</span> to <span class="math-inline">$\frac{\pi}{2}$</span> is the flipped horizontally between <span class="math-inline">$\frac{\pi}{2}$</span> and <span class="math-inline">$\pi$</span>, then horizontally and vertically between <span class="math-inline">$\pi$</span> and <span class="math-inline">$\frac{3\pi}{2}$</span>, and finally flipped vertially from <span class="math-inline">$\frac{3\pi}{2}$</span> to <span class="math-inline">$2\pi$</span>.</p><h2 id="flip-flops-"><a href="#flip-flops-" class="header-link">Flip Flops 🩴</a></h2><p>Since we can already calculate all the numbers from <span class="math-inline">$0$</span> to <span class="math-inline">$\frac{\pi}{2}$</span> in <span class="math-inline">$sin$</span>, all we've gotta do is figure out some swift functions to flip flop around our existing results.</p><p>Here's what we're starting with, with each quadrant that we need to flip or flop in a different color.</p><img src="orig.png" alt="orig"/><ol><li>Vertical Flips</li></ol><p>It's pretty easy to flip a function vertically. In math it's called the <em>reflection</em> of a function. All we have to do is make the entire function negative and it'll be flipped vertically.</p><img src="vert.gif"/><blockquote><p>Source: https://mathbitsnotebook.com/Algebra1/FunctionGraphs/FNGTransformationFunctions.html</p></blockquote><p>The only areas we need to vertically flip <span class="math-inline">$sin(x)$</span> are between <span class="math-inline">$\pi$</span> and <span class="math-inline">$2\pi$</span>, where <span class="math-inline">$sin(x)$</span> is negative.</p><p>After applying the vertical flops, our graph looks like this</p><img src="vert-flip.png" alt="vert-flip"/><ol start="2"><li>Horizontal Flops</li></ol><p>Now all we have to do is flop the blue and purple lines backwards. We can do this by just shifting the <span class="math-inline">$x$</span> value <span class="math-inline">$\frac{\pi}{2}$</span> to the left.</p><p>After the horizontal flop we end up with this graph.</p><img src="hor-flip.png" alt="hor-flip"/><p>Sweet! Now we can use these flip flops in our sin function in swift to calculate any value for <span class="math-inline">$sin(x)$</span>.</p><h2 id="swift-flip-flops-"><a href="#swift-flip-flops-" class="header-link">Swift Flip Flops 🐥🩴</a></h2><p>Now to implement these stylish shoes in Swift.</p><ol><li>Vertical Flips</li></ol><p>As said before, all we have to do to flip a function vertically is make sin negative. That's super easy in swift, so here's the vertical flip function.</p><pre><code class="language-swift">sin(-input)
</code></pre><ol start="2"><li>Horizontal Flops</li></ol><p>All we need to do here is subtract <span class="math-inline">$\frac{\pi}{2}$</span> from the <code>input</code> variable and we're good to go!</p><pre><code class="language-swift">sin(input - (Double.pi/2))
</code></pre><h2 id="finally"><a href="#finally" class="header-link">Finally...</a></h2><p>Yay! Now all we have to do is</p><ol><li>Reduce <span class="math-inline">$x$</span> to be between <span class="math-inline">$0$</span> and <span class="math-inline">$2\pi$</span>.</li><li>Flip flop our way to our result!</li></ol><p>Here are the few rules that we'll need to follow to figure out which flip or flop to use.</p><ol><li>If <span class="math-inline">$x$</span> is between <span class="math-inline">$\pi$</span> and <span class="math-inline">$2\pi$</span>, flip it <u>vertically</u>.</li><li>If <span class="math-inline">$x$</span> is between <span class="math-inline">$\frac{\pi}{2}$</span> and <span class="math-inline">$\pi$</span> <em>or</em> <span class="math-inline">$\frac{3\pi}{2}$</span> and <span class="math-inline">$2\pi$</span>, flip it <u>horizontally</u>.</li></ol><p>With these rules in mind, we almost have the swift code written for us! I'll just take those "If <span class="math-inline">$x$</span> is..." and turn them into <code>if</code> statements.</p><p>Here's the final swift implementation of <span class="math-inline">$sin(x)$</span>.</p><pre><code class="language-swift">let S1 = -1.66666666666666324348e-01;  // -1/(3!)
let S2 = 8.3333333332248946124e-03;    //  1/(5!)
let S3 = -1.98412698298579493134e-04;  // -1/(7!)
let S4 = 2.75573137070700676789e-06;   //  1/(9!)
let S5 = -2.50507602534068634195e-08;  // -1/(11!)
let S6 = 1.58969099521155010221e-10;   //  1/(13!)

func usersin(_ xOrig: Double) -&gt; Double {
    // Reduce x to be between 0 and 2pi
    var x = xOrig.truncatingRemainder(dividingBy: 2 * Double.pi)

    // If it's between pi/2 =&gt; pi or 3pi/2 =&gt; 2pi. Flip it horizontally
    if (x &gt; Double.pi/2 &amp;&amp; x &lt; Double.pi) || (x &gt; (3*Double.pi)/2 &amp;&amp; x &lt; 2*Double.pi) {
        x = x - (Double.pi/2)
    }

    let z = x*x                          // x^2
    let v = z*x                          // x^3
    let r = S2+z*(S3+z*(S4+z*(S5+z*S6))) // Taylor function part 1/2

    // Flip the function if needed, eg between pi and 2pi
    if x &gt; Double.pi &amp;&amp; x &lt; Double.pi * 2 {
        return -x+v*(S1+z*r)             // Taylor function part 2/2 (but negative)
    } else {
        // No need for vertical flip
        return x+v*(S1+z*r)             // Taylor function part 2/2
    }
}
</code></pre><h2 id="benchmark"><a href="#benchmark" class="header-link">Benchmark</a></h2><p>I decided to test the speed of this implementation, and the benchmarks look pretty good. For 1,000,000 <span class="math-inline">$sin(x)$</span> operations, the results look like:</p><pre><code>Time elapsed for User Sin: 0.7528519630432129 s.
Time elapsed for Normal Sin: 0.6716610193252563 s.
</code></pre><p>So not too far off between them. The code I used to benchmark is below.</p><pre><code class="language-swift">#!/usr/bin/swift

import Foundation

... User sin defined up here ...

func printTimeElapsedWhenRunning(title: String, operation: (() -&gt; Void)) {
    let startTime = CFAbsoluteTimeGetCurrent()
    operation()
    let timeElapsed = CFAbsoluteTimeGetCurrent() - startTime
    print("Time elapsed for \(title): \(timeElapsed) s.")
}

printTimeElapsedWhenRunning(title: "User Sin") {
    for i in 0..&lt;1000000 {
        let _ = usersin(Double(i))
    }
}

printTimeElapsedWhenRunning(title: "Normal Sin") {
    for i in 0..&lt;1000000 {
        let _ = sin(Double(i))
    }
}

</code></pre><blockquote><p>After running this code ~10 times the results were within 0.001s of each other, so the error from this test is negligible.</p></blockquote><h2 id="conclusion"><a href="#conclusion" class="header-link">Conclusion</a></h2><p>While it's fun to figure out and define our own implementation of <span class="math-inline">$sin(x)$</span>, it's not super practical. Other programers have already figured out this math, and have figured out ways of making it slightly faster than my own. So, is it practical? No. But it was fun to do!</p><hr></hr><div class="article-footer"><p>May 8, 2021</p><div class="avatar" href="/about.html"><a href="/about.html"><img alt="Avatar Image" height="24" src="/assets/avatar.webp" width="24"></img><span>Khan Winter</span></a>·<a href="https://bsky.app/profile/khanwinter.com" target="_blank"><svg aria-label="Bluesky" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 530" version="1.1"><path d="m135.72 44.03c66.496 49.921 138.02 151.14 164.28 205.46 26.262-54.316 97.782-155.54 164.28-205.46 47.98-36.021 125.72-63.892 125.72 24.795 0 17.712-10.155 148.79-16.111 170.07-20.703 73.984-96.144 92.854-163.25 81.433 117.3 19.964 147.14 86.092 82.697 152.22-122.39 125.59-175.91-31.511-189.63-71.766-2.514-7.3797-3.6904-10.832-3.7077-7.8964-0.0174-2.9357-1.1937 0.51669-3.7077 7.8964-13.714 40.255-67.233 197.36-189.63 71.766-64.444-66.128-34.605-132.26 82.697-152.22-67.108 11.421-142.55-7.4491-163.25-81.433-5.9562-21.282-16.111-152.36-16.111-170.07 0-88.687 77.742-60.816 125.72-24.795z"/></svg></a></div></div></article></div><footer><p>Copyright &copy Khan Winter 2025</p><p><a href="https://github.com/thecoolwinter/blog">Built In Swift</a></p><p><a href="https://bsky.app/profile/khanwinter.com" rel="me" target="_blank">Bluesky</a> | <a href>RSS</a></p></footer></body></html>